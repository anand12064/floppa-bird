<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> SKY FLYER BY ANAND </title>
    <style>
        body { margin: 0; overflow: hidden; background: #4ec0ca; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
        canvas { border: 4px solid #333; border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); background: #70c5ce; cursor: pointer; }
        .ui-layer { position: absolute; text-align: center; pointer-events: none; width: 320px; }
        .btn { pointer-events: auto; padding: 12px 24px; font-size: 20px; background: #e67e22; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; box-shadow: 0 4px #d35400; }
        .btn:active { transform: translateY(2px); box-shadow: 0 2px #d35400; }
        #score-val { font-size: 40px; color: white; text-shadow: 2px 2px #000; font-weight: bold; margin-top: 20px; }
    </style>
</head>
<body>

    <div id="score-val">0</div>
    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score-val');

        canvas.width = 320;
        canvas.height = 480;

        // Game Constants
        const GRAVITY = 0.25;
        const JUMP = -4.6;
        let gameState = 'START'; // START, PLAYING, GAMEOVER
        let score = 0;
        let highScore = localStorage.getItem('fbHighScore') || 0;

        // Bird Object
        let bird = { x: 50, y: 200, w: 34, h: 24, velocity: 0, rotation: 0 };
        
        // Arrays for objects
        let pipes = [];
        let clouds = [
            { x: 50, y: 50, s: 0.5 },
            { x: 200, y: 120, s: 0.3 },
            { x: 120, y: 80, s: 0.4 }
        ];

        // Input Handling
        function handleAction() {
            if (gameState === 'START') {
                resetGame();
                gameState = 'PLAYING';
            } else if (gameState === 'PLAYING') {
                bird.velocity = JUMP;
            } else if (gameState === 'GAMEOVER') {
                resetGame();
                gameState = 'PLAYING';
            }
        }

        window.addEventListener('keydown', (e) => { if (e.code === 'Space') handleAction(); });
        canvas.addEventListener('mousedown', handleAction);

        function resetGame() {
            bird = { x: 50, y: 200, w: 34, h: 24, velocity: 0, rotation: 0 };
            pipes = [];
            score = 0;
            scoreEl.innerText = "0";
        }

        function createPipe() {
            let gap = 110;
            let minH = 50;
            let h = Math.floor(Math.random() * (canvas.height - gap - 100)) + minH;
            pipes.push({ x: canvas.width, top: h, bottom: canvas.height - h - gap, passed: false });
        }

        function update() {
            // Move Clouds always
            clouds.forEach(c => {
                c.x -= c.s;
                if (c.x < -60) c.x = canvas.width + 20;
            });

            if (gameState !== 'PLAYING') return;

            bird.velocity += GRAVITY;
            bird.y += bird.velocity;
            bird.rotation = Math.min(Math.PI / 4, Math.max(-Math.PI / 4, (bird.velocity / 10)));

            if (bird.y + bird.h > canvas.height || bird.y < 0) endGame();

            if (Math.floor(Date.now() / 15) % 100 === 0 && pipes.length < 3) {
                if(pipes.length === 0 || pipes[pipes.length-1].x < canvas.width - 180) createPipe();
            }

            pipes.forEach((p, i) => {
                p.x -= 2.5;
                // Collision
                if (bird.x + bird.w > p.x && bird.x < p.x + 50 && (bird.y < p.top || bird.y + bird.h > canvas.height - p.bottom)) {
                    endGame();
                }
                // Score
                if (!p.passed && bird.x > p.x + 50) {
                    score++;
                    scoreEl.innerText = score;
                    p.passed = true;
                }
                if (p.x < -50) pipes.splice(i, 1);
            });
        }

        function endGame() {
            gameState = 'GAMEOVER';
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('fbHighScore', highScore);
            }
        }

        function drawCloud(c) {
            ctx.fillStyle = "rgba(255, 255, 255, 0.8)";
            ctx.beginPath();
            ctx.arc(c.x, c.y, 20, 0, Math.PI * 2);
            ctx.arc(c.x + 15, c.y - 10, 20, 0, Math.PI * 2);
            ctx.arc(c.x + 30, c.y, 20, 0, Math.PI * 2);
            ctx.fill();
        }

        function draw() {
            // Sky
            ctx.fillStyle = "#70c5ce";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            clouds.forEach(c => drawCloud(c));

            pipes.forEach(p => {
                ctx.fillStyle = "#2ecc71";
                ctx.fillRect(p.x, 0, 50, p.top); // Top
                ctx.fillRect(p.x, canvas.height - p.bottom, 50, p.bottom); // Bottom
                // Pipe caps
                ctx.fillStyle = "#27ae60";
                ctx.fillRect(p.x - 2, p.top - 15, 54, 15);
                ctx.fillRect(p.x - 2, canvas.height - p.bottom, 54, 15);
            });

            // Bird
            ctx.save();
            ctx.translate(bird.x + bird.w/2, bird.y + bird.h/2);
            ctx.rotate(bird.rotation);
            ctx.fillStyle = "#f1c40f"; // Body
            ctx.fillRect(-bird.w/2, -bird.h/2, bird.w, bird.h);
            ctx.fillStyle = "white"; // Eye
            ctx.fillRect(5, -8, 8, 8);
            ctx.fillStyle = "#e67e22"; // Beak
            ctx.fillRect(12, 2, 10, 8);
            ctx.restore();

            // Overlays
            if (gameState === 'START') {
                drawOverlay("FLAPPY SKY", "CLICK TO PLAY");
            } else if (gameState === 'GAMEOVER') {
                drawOverlay("GAME OVER", `BEST: ${highScore}`, "RETRY");
            }
        }

        function drawOverlay(title, sub, btnText) {
            ctx.fillStyle = "rgba(0,0,0,0.4)";
            ctx.fillRect(0,0, canvas.width, canvas.height);
            ctx.fillStyle = "white";
            ctx.textAlign = "center";
            ctx.font = "bold 30px Arial";
            ctx.fillText(title, canvas.width/2, canvas.height/2 - 40);
            ctx.font = "20px Arial";
            ctx.fillText(sub, canvas.width/2, canvas.height/2);
            
            if(btnText) {
                ctx.fillStyle = "#e67e22";
                ctx.fillRect(canvas.width/2 - 50, canvas.height/2 + 30, 100, 40);
                ctx.fillStyle = "white";
                ctx.font = "bold 16px Arial";
                ctx.fillText(btnText, canvas.width/2, canvas.height/2 + 55);
            }
        }

        function loop() {
            update();
            draw();
            requestAnimationFrame(loop);
        }

        loop();
    </script>
</body>
</html>
